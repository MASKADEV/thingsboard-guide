#### 环境准备

- release-3.2分支源码，可参考[编译](编译.md)


#### 描述

规则引擎是Thingsboard的核心部分，实时数据经过规则引擎进行处理到达目的地。


#### 分析
规则引擎使用了Actor模型，早期版本2.x使用`Akka`框架实现，3.x为自行实现，服务启动类为`DefaultActorService`。



##### 属性

- `ActorSystemContext`，Actor系统上下文，包含一些通用服务以及基础操作方法，每个Actor在初始化阶段均需要Actor系统上下文对象
- `AppActor`，整个Actor模型的根，也是消息进入规则引擎的入口

- `StatsActor`，状态Actor，用于定时统计规则链Actor以及规则节点Actor状态，以事件`Event`进行存储。


##### 流程
分为两个阶段：  
1. 类初始化，方法为：`initActorSystem`


2. 应用准备完成，方法为`onApplicationEvent`




#### TIPS

- Actor模型 [wiki](https://en.wikipedia.org/wiki/Actor_model)















